(function () {
  angular.module('inkfilepicker', [])
  .factory('$filepicker', [function () {
    (function(){
      "use strict";!function(){var e=function(){var e={},t=function(t,r,n){for(var o=t.split("."),i=0;i<o.length-1;i++)n[o[i]]||(n[o[i]]={}),n=n[o[i]];n[o[i]]="function"==typeof r?r.isClass?r:function(){return r.apply(e,arguments)}:r},r=function(r,n,o){t(r,n,e),o&&t(r,n,window.filepicker)},n=function(t,n,o){"function"==typeof t&&(o=n,n=t,t=""),t&&(t+=".");var i=n.call(e);for(var a in i)r(t+a,i[a],o)},o=function(t){t.apply(e,arguments)};return{extend:n,internal:o}}();if(window.filepicker)for(var t in e)window.filepicker[t]=e[t];else window.filepicker=e}(),filepicker.extend("errors",function(){var e=this,t=function(e){if(this===window)return new t(e);if(this.code=e,filepicker.debug){var r=filepicker.error_map[this.code];this.message=r.message,this.moreInfo=r.moreInfo,this.toString=function(){return"FPError "+this.code+": "+this.message+". For help, see "+this.moreInfo}}else this.toString=function(){return"FPError "+this.code+". Include filepicker_debug.js for more info"};return this};t.isClass=!0;var r=function(t){filepicker.debug&&e.util.console.error(t.toString())};return{FPError:t,handleError:r}},!0),filepicker.extend("handlers",function(){var e={},t=function(t,r){return e.hasOwnProperty(t)?e[t].push(r):e[t]=[r],r},r=function(t,r){var n=e[t];if(n)if(r){for(var o=0;o<n.length;o++)if(n[o]===r){n.splice(o,1);break}0===n.length&&delete e[t]}else delete e[t]},n=function(t){var r=t.id;if(e.hasOwnProperty(r)){for(var n=e[r],o=0;o<n.length;o++)n[o](t);return!0}return!1};return{attach:t,detach:r,run:n}}),filepicker.extend("exporter",function(){var e=this,t=function(t){var r=function(r,n,o){t[n]&&!e.util.isArray(t[n])?t[n]=[t[n]]:t[r]?t[n]=[t[r]]:o&&(t[n]=o)};if(t.mimetype&&t.extension)throw e.FilepickerException("Error: Cannot pass in both mimetype and extension parameters to the export function");if(r("service","services"),t.services)for(var n=0;n<t.services.length;n++){var o=(""+t.services[n]).replace(" ",""),i=e.services[o];t.services[n]=void 0===i?o:i}t.openTo&&(t.openTo=e.services[t.openTo]||t.openTo),e.util.setDefault(t,"container",e.browser.isMobile?"window":"modal")},r=function(t,r){var n=function(n){if("filepickerUrl"===n.type){if(n.error)e.util.console.error(n.error),r(e.errors.FPError(132));else{var o={};o.url=n.payload.url,o.filename=n.payload.data.filename,o.mimetype=n.payload.data.type,o.size=n.payload.data.size,o.isWriteable=!0,t(o)}e.modal.close()}};return n},n=function(o,i,a,s){if(t(i),i.debug)return void setTimeout(function(){a({url:"https://www.filepicker.io/api/file/-nBq2onTSemLBxlcBWn1",filename:"test.png",mimetype:"image/png",size:58979})},1);if(void 0===e.cookies.THIRD_PARTY_COOKIES){var l=!1;return void e.cookies.checkThirdParty(function(){l||(n(o,i,a,s),l=!0)})}var c=e.util.getId(),u=!1,d=function(e){u=!0,a(e)},f=function(e){u=!0,s(e)},p=function(){u||(u=!0,s(e.errors.FPError(131)))};e.window.open(i.container,i.mobile,e.urls.constructExportUrl(o,i,c),p),e.handlers.attach(c,r(d,f))};return{createExporter:n}}),filepicker.extend("modal",function(){function e(){var e=document.getElementById(i);e&&(e.hidden=!0);var r=document.getElementById(a);r&&(r.hidden=!0),t()}function t(){var e=n();e&&(e.style.overflow=l)}function r(){var e=".fp__overlay {top: 0;right: 0;bottom: 0;left: 0;z-index: 1000;background: rgba(0, 0, 0, 0.8);}.fp__close {top: 104px; right: 108px; width: 35px; height: 35px; z-index: 20; cursor: pointer}@media screen and (max-width: 768px), screen and (max-height: 500px) {.fp__close {top: 15px; right: 12px;}}.fp__close a {text-indent: -9999px; overflow: hidden; display: block; width: 100%; height: 100%; background: url(https://s3.amazonaws.com/f.cl.ly/items/3d2n0N383l3a3Z1I0U0n/close.png) 50% 50% no-repeat;}.fp__close a:hover {background-color: rgba(0,0,0, .02); opacity: .8;}@media screen and (max-width: 768px), screen and (max-height: 500px) {top: 14px; right: 14px;}.fp__copy {display: none;}.fp__container {-webkit-overflow-scrolling: touch; overflow: hidden; min-height: 300px; top: 100px;right: 100px;bottom: 100px;left: 100px;background: #eee; box-sizing:content-box; -webkit-box-sizing:content-box; -moz-box-sizing:content-box;}@media screen and (max-width: 768px), screen and (max-height: 500px) {.fp__copy {bottom: 0; left: 0; right: 0; height: 20px; background: #333;}}@media screen and (max-width: 768px), screen and (max-height: 500px) {.fp__copy a {margin-left: 5px;}}@media screen and (max-width: 768px), screen and (max-height: 500px) {.fp__container {top: 0;right: 0;bottom: 0;left: 0;}}.fp__overlay, .fp__close, .fp__copy, .fp__container {position: fixed;}",t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t.appendChild(r)}function n(){try{return document.getElementsByTagName("html")[0]}catch(e){return null}}var o=this,i="filepicker_shade",a="filepicker_dialog_container",s=n();if(s)var l=s.style.overflow;var c=function(e,t,i){r();var a=u(i),s=d(t),l=f(i),c=document.createElement("iframe");c.name=o.window.WINDOW_NAME,c.id=o.window.WINDOW_NAME,c.style.width="100%",c.style.height="100%",c.style.border="none",c.style.position="relative",c.setAttribute("border",0),c.setAttribute("frameborder",0),c.setAttribute("frameBorder",0),c.setAttribute("marginwidth",0),c.setAttribute("marginheight",0),c.src=e,s.appendChild(c),a.appendChild(l),a.appendChild(s),document.body.appendChild(a);var p=n();return p&&(p.style.overflow="hidden"),c},u=function(e){var t=document.createElement("div");return t.id=i,t.className="fp__overlay",t.onclick=p(e),t},d=function(){var e=document.createElement("div");return e.id=a,e.className="fp__container",e},f=function(e){var t=document.createElement("div");t.className="fp__close";var r=document.createElement("a");return r.appendChild(document.createTextNode("X")),t.appendChild(r),r.onclick=p(e),document.onkeydown=function(t){t=t||window.event,27===t.keyCode&&p(e)()},t},p=function(e,r){return r=!!r,function(){if(!o.uploading||r||window.confirm('You are currently uploading. If you choose "OK", the window will close and your upload will not finish. Do you want to stop uploading and close the window?')){o.uploading=!1,document.onkeydown=null,t();var n=document.getElementById(i);n&&document.body.removeChild(n);var s=document.getElementById(a);s&&document.body.removeChild(s);try{delete window.frames[o.window.WINDOW_NAME]}catch(l){}e&&e()}}},m=p(function(){});return{generate:c,close:m,hide:e}}),filepicker.extend("picker",function(){function e(e,r){if("filepickerProgress"===e.type)t.uploading=!0,r&&r(e.payload.data);else if("notUploading"===e.type)t.uploading=!1;else if("closeModal"===e.type)t.modal.close();else if("hideModal"===e.type)t.modal.hide();else if("filepickerUrl"===e.type)return!1;return!0}var t=this,r=function(e){var r=function(r,n,o){e[n]?t.util.isArray(e[n])||(e[n]=[e[n]]):e[r]?e[n]=[e[r]]:o&&(e[n]=o)};if(r("service","services"),r("mimetype","mimetypes"),r("extension","extensions"),e.services)for(var n=0;n<e.services.length;n++){var o=(""+e.services[n]).replace(" ","");void 0!==t.services[o]&&(o=t.services[o]),e.services[n]=o}if(e.mimetypes&&e.extensions)throw t.FilepickerException("Error: Cannot pass in both mimetype and extension parameters to the pick function");e.mimetypes||e.extensions||(e.mimetypes=["*/*"]),e.openTo&&(e.openTo=t.services[e.openTo]||e.openTo),t.util.setDefault(e,"container",t.browser.isMobile?"window":"modal")},n=function(r,n,o){var i=function(i){if(!e(i,o)){if(t.uploading=!1,i.error)t.util.console.error(i.error),n(t.errors.FPError(102));else{var a=s(i.payload);r(a)}t.modal.close()}};return i},o=function(r,n,o){var i=function(i){e(i,o)||(t.uploading=!1,i.error?(t.util.console.error(i.error),n(t.errors.FPError(102))):(i.payload.data.url=i.payload.url,r(i.payload.data)),t.modal.close())};return i},i=function(e){e=e||function(){};var r=function(r){"uploading"===r.type&&(t.uploading=!!r.payload,e(t.uploading))};return r},a=function(e,t,r){e[r]&&(t[r]=e[r])},s=function(e){var t={},r=e.url;r&&r.url&&(r=r.url),t.url=r;var n=e.url.data||e.data;return t.filename=n.filename,t.mimetype=n.type,t.size=n.size,a(n,t,"id"),a(n,t,"key"),a(n,t,"container"),a(n,t,"path"),t.isWriteable=!0,t},l=function(r,n,o){var i=function(i){if(!e(i,o)){if(t.uploading=!1,i.error)t.util.console.error(i.error),n(t.errors.FPError(102));else{var a=[];t.util.isArray(i.payload)||(i.payload=[i.payload]);for(var l=0;l<i.payload.length;l++){var c=s(i.payload[l]);a.push(c)}r(a)}t.modal.close()}};return i},c=function(e,a,s,u,d,f,p){if(r(e),e.debug){var m,h={url:"https://www.filepicker.io/api/file/-nBq2onTSemLBxlcBWn1",filename:"test.png",mimetype:"image/png",size:58979};return m=u||e.storeLocation?[h,h,h]:h,void setTimeout(function(){a(m)},1)}if(void 0===t.cookies.THIRD_PARTY_COOKIES){var g=!1;return void t.cookies.checkThirdParty(function(){g||(c(e,a,s,!!u,d,f),g=!0)})}var v,w,y=t.util.getId(),x=!1,E=function(t){"window"===e.container&&(window.onbeforeunload=null),x=!0,a(t)},F=function(e){x=!0,s(e)},b=function(){x||(x=!0,s(t.errors.FPError(101)))};p?(v=t.urls.constructConvertUrl(e,y),w=n(E,F,f)):u?(v=t.urls.constructPickUrl(e,y,!0),w=l(E,F,f)):d?(v=t.urls.constructPickFolderUrl(e,y),w=o(E,F,f)):(v=t.urls.constructPickUrl(e,y,!1),w=n(E,F,f)),t.window.open(e.container,e.mobile,v,b),t.handlers.attach(y,w);var k=y+"-upload";t.handlers.attach(k,i(function(){t.handlers.detach(k)}))};return{createPicker:c}}),filepicker.extend("window",function(){var e=this,t="filepicker_dialog",r="left=100,top=100,height=600,width=800,menubar=no,toolbar=no,location=no,personalbar=no,status=no,resizable=yes,scrollbars=yes,dependent=yes,dialog=yes",n=100,o=function(){var e,t;return document.body&&document.body.offsetWidth&&(e=document.body.offsetWidth,t=document.body.offsetHeight),"CSS1Compat"===document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(e=document.documentElement.offsetWidth,t=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(e=window.innerWidth,t=window.innerHeight),[e,t]},i=function(o,i,a,s){s=s||function(){};var l=e.browser.isIOS()||e.browser.isAndroid();if(!o&&l?o="window":o||(o="modal"),"window"===o){var c=t+e.util.getId();window.onbeforeunload=function(){return"Filepicker upload does not complete."};var u=window.open(a,c,r);u||(window.onbeforeunload=null,window.alert("Please disable your popup blocker to upload files."));var d=window.setInterval(function(){(!u||u.closed)&&(window.onbeforeunload=null,window.clearInterval(d),s())},n)}else if("modal"===o){var f=i?window.JSON.parse(i):!1;e.modal.generate(a,f,s)}else{var p=document.getElementById(o);if(!p)throw new e.FilepickerException('Container "'+o+'" not found. This should either be set to "window","modal", or the ID of an iframe that is currently in the document.');p.src=a}};return{open:i,WINDOW_NAME:t,getSize:o}}),filepicker.extend("comm",function(){var e=this,t="filepicker_comm_iframe",r="fpapi_comm_iframe",n=function(){if(void 0===window.frames[t]){a();var n;n=document.createElement("iframe"),n.id=n.name=t,n.src=e.urls.COMM,n.style.display="none",document.body.appendChild(n)}if(void 0===window.frames[r]){a();var o;o=document.createElement("iframe"),o.id=o.name=r,o.src=e.urls.API_COMM,o.style.display="none",document.body.appendChild(o)}},o=function(t){if(t.origin===e.urls.BASE||t.origin===e.urls.DIALOG_BASE){var r=e.json.parse(t.data);e.handlers.run(r)}},i=!1,a=function(){if(!i)if(i=!0,window.addEventListener)window.addEventListener("message",o,!1);else{if(!window.attachEvent)throw new e.FilepickerException("Unsupported browser");window.attachEvent("onmessage",o)}},s=function(){if(window.removeEventListener)window.removeEventListener("message",o,!1);else{if(!window.attachEvent)throw new e.FilepickerException("Unsupported browser");window.detachEvent("onmessage",o)}if(i){i=!1;for(var n=document.getElementsByName(t),a=0;a<n.length;a++)n[a].parentNode.removeChild(n[a]);try{delete window.frames[t]}catch(s){}for(var l=document.getElementsByName(r),c=0;c<l.length;c++)l[c].parentNode.removeChild(l[c]);try{delete window.frames[r]}catch(s){}}};return{openChannel:n,closeChannel:s}}),filepicker.extend("comm_fallback",function(){var e,t,r=this,n="filepicker_comm_iframe",o="host_comm_iframe",i="",a=200,s=function(){l()},l=function(){if(void 0===window.frames[o]){var e;e=document.createElement("iframe"),e.id=e.name=o,i=e.src=r.urls.constructHostCommFallback(),e.style.display="none";var t=function(){i=e.contentWindow.location.href,c()};e.attachEvent?e.attachEvent("onload",t):e.onload=t,document.body.appendChild(e)}},c=function(){if(void 0===window.frames[n]){var e;e=document.createElement("iframe"),e.id=e.name=n,e.src=r.urls.FP_COMM_FALLBACK+"?host_url="+encodeURIComponent(i),e.style.display="none",document.body.appendChild(e)}p()},u=!1,d="",f=function(){var e=window.frames[n];if(e){var t=e.frames[o];if(t){var i=t.location.hash;if(i&&"#"===i.charAt(0)&&(i=i.substr(1)),i!==d&&(d=i)){var a;try{a=r.json.parse(i)}catch(s){}a&&r.handlers.run(a)}}}},p=function(){u||(u=!0,e=window.setInterval(f,a))},m=function(){if(window.clearInterval(e),u){u=!1;for(var t=document.getElementsByName(n),r=0;r<t.length;r++)t[r].parentNode.removeChild(t[r]);try{delete window.frames[n]}catch(i){}for(t=document.getElementsByName(o),r=0;r<t.length;r++)t[r].parentNode.removeChild(t[r]);try{delete window.frames[o]}catch(i){}}},h=!("postMessage"in window),g=function(){t=r.comm,r.comm={openChannel:s,closeChannel:m}};return h&&g(),{openChannel:s,closeChannel:m,isEnabled:h}}),filepicker.extend("cookies",function(){var e=this,t=function(t){var r=function(r){"ThirdPartyCookies"===r.type&&(e.cookies.THIRD_PARTY_COOKIES=!!r.payload,t&&"function"==typeof t&&t(!!r.payload))};return r},r=function(r){var n=t(r);e.handlers.attach("cookies",n),e.comm.openChannel()};return{checkThirdParty:r}}),filepicker.extend("ajax",function(){var e=this,t=function(e,t){t.method="GET",i(e,t)},r=function(t,r){r.method="POST",t+=(t.indexOf("?")>=0?"&":"?")+"_cacheBust="+e.util.getId(),i(t,r)},n=function(t,r){var o=[];for(var i in t){var a=t[i];r&&(i=r+". + key + ");var s;switch(e.util.typeOf(a)){case"object":s=n(a,i);break;case"array":for(var l={},c=0;c<a.length;c++)l[c]=a[c];s=n(l,i);break;default:s=i+"="+encodeURIComponent(a)}null!==a&&o.push(s)}return o.join("&")},o=function(){try{return new window.XMLHttpRequest}catch(e){try{return new window.ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}}},i=function(t,r){t=t||"";var i=r.method?r.method.toUpperCase():"POST",s=r.success||function(){},l=r.error||function(){},c=void 0===r.async?!0:r.async,u=r.data||null,d=void 0===r.processData?!0:r.processData,f=r.headers||{},p=e.util.parseUrl(t),m=window.location.protocol+"//"+window.location.host,h=m!==p.origin,g=!1;t+=(t.indexOf("?")>=0?"&":"?")+"plugin="+e.urls.getPlugin(),u&&d&&(u=n(r.data));var v;if(r.xhr)v=r.xhr;else if(v=o(),!v)return r.error("Ajax not allowed"),v;if(h&&window.XDomainRequest&&!("withCredentials"in v))return new a(t,r);r.progress&&v.upload&&v.upload.addEventListener("progress",function(e){e.lengthComputable&&r.progress(Math.round(95*e.loaded/e.total))},!1);var w=function(){if(4==v.readyState&&!g)if(r.progress&&r.progress(100),v.status>=200&&v.status<300){var t=v.responseText;if(r.json)try{t=e.json.decode(t)}catch(n){return void y.call(v,"Invalid json: "+t)}s(t,v.status,v),g=!0}else y.call(v,v.responseText),g=!0};v.onreadystatechange=w;var y=function(e){return g?void 0:(r.progress&&r.progress(100),g=!0,400==this.status?void l("bad_params",this.status,this):403==this.status?void l("not_authorized",this.status,this):404==this.status?void l("not_found",this.status,this):h?4==this.readyState&&0===this.status?void l("CORS_not_allowed",this.status,this):void l("CORS_error",this.status,this):void l(e,this.status,this))};v.onerror=y,u&&"GET"==i&&(t+=(-1!==t.indexOf("?")?"&":"?")+u,u=null),v.open(i,t,c),r.json?v.setRequestHeader("Accept","application/json, text/javascript"):v.setRequestHeader("Accept","text/javascript, text/html, application/xml, text/xml, */*");var x=f["Content-Type"]||f["content-type"];if(u&&d&&("POST"==i||"PUT"==i)&&void 0===x&&v.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),f)for(var E in f)v.setRequestHeader(E,f[E]);return v.send(u),v},a=function(t,r){if(!window.XDomainRequest)return null;var o=r.method?r.method.toUpperCase():"POST",i=r.success||function(){},a=r.error||function(){},s=r.data||{};if("http:"==window.location.protocol?t=t.replace("https:","http:"):"https:"==window.location.protocol&&(t=t.replace("http:","https:")),r.async)throw new e.FilepickerException("Asyncronous Cross-domain requests are not supported");"GET"!==o&&"POST"!==o&&(s._method=o,o="POST"),r.processData!==!1&&(s=s?n(s):null),s&&"GET"==o&&(t+=(t.indexOf("?")>=0?"&":"?")+s,s=null),t+=(t.indexOf("?")>=0?"&":"?")+"_xdr=true&_cacheBust="+e.util.getId();var l=new window.XDomainRequest;return l.onload=function(){var t=l.responseText;if(r.progress&&r.progress(100),r.json)try{t=e.json.decode(t)}catch(n){return void a("Invalid json: "+t,200,l)}i(t,200,l)},l.onerror=function(){r.progress&&r.progress(100),a(l.responseText||"CORS_error",this.status||500,this)},l.onprogress=function(){},l.ontimeout=function(){},l.timeout=3e4,l.open(o,t,!0),l.send(s),l};return{get:t,post:r,request:i}}),filepicker.extend("files",function(){var e=this,t=function(t,n,o,i,a){var s=void 0===n.base64encode;s&&(n.base64encode=!0),n.base64encode=n.base64encode!==!1;var l=function(t){s&&(t=e.base64.decode(t,!!n.asText)),o(t)};r.call(this,t,n,l,i,a)},r=function(t,r,n,o,i){r.cache!==!0&&(r._cacheBust=e.util.getId()),e.ajax.get(t,{data:r,headers:{"X-NO-STREAM":!0},success:n,error:function(t){o("CORS_not_allowed"===t?new e.errors.FPError(113):"CORS_error"===t?new e.errors.FPError(114):"not_found"===t?new e.errors.FPError(115):"bad_params"===t?new e.errors.FPError(400):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(118))},progress:i})},n=function(t,r,n,o,i){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return i(10),void e.files.storeFile(t,{},function(t){i(50),e.files.readFromFPUrl(t.url,r,n,o,function(e){i(50+e/2)})},o,function(e){i(e/2)});var a=!!r.base64encode,s=!!r.asText,l=new FileReader;l.onprogress=function(e){e.lengthComputable&&i(Math.round(e.loaded/e.total*100))},l.onload=function(t){i(100),n(a?e.base64.encode(t.target.result,s):t.target.result)},l.onerror=function(t){switch(t.target.error.code){case t.target.error.NOT_FOUND_ERR:o(new e.errors.FPError(115));break;case t.target.error.NOT_READABLE_ERR:o(new e.errors.FPError(116));break;case t.target.error.ABORT_ERR:o(new e.errors.FPError(117));break;default:o(new e.errors.FPError(118))}},s||!l.readAsBinaryString?l.readAsText(t):l.readAsBinaryString(t)},o=function(t,r,n,o,i,a){var s=n.mimetype||"text/plain";e.ajax.post(e.urls.constructWriteUrl(t,n),{headers:{"Content-Type":s},data:r,processData:!1,json:!0,success:function(t){o(e.util.standardizeFPFile(t))},error:function(t){i("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},progress:a})},i=function(t,r,n,o,i,a){var s=function(t){i("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},l=function(t){o(e.util.standardizeFPFile(t))};u(r,e.urls.constructWriteUrl(t,n),l,s,a)},a=function(t,r,n,o,i,a){var s=function(t){i("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},l=function(t){o(e.util.standardizeFPFile(t))};n.mimetype=r.type,u(r,e.urls.constructWriteUrl(t,n),l,s,a)},s=function(t,r,n,o,i,a){e.ajax.post(e.urls.constructWriteUrl(t,n),{data:{url:r},json:!0,success:function(t){o(e.util.standardizeFPFile(t))},error:function(t){i("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},progress:a})},l=function(t,r,n,o,i){if(t.files)return void(0===t.files.length?o(new e.errors.FPError(115)):c(t.files[0],r,n,o,i));e.util.setDefault(r,"location","S3"),r.filename||(r.filename=t.value.replace("C:\\fakepath\\","")||t.name);var a=t.name;t.name="fileUpload",e.iframeAjax.post(e.urls.constructStoreUrl(r),{data:t,processData:!1,json:!0,success:function(r){t.name=a,n(e.util.standardizeFPFile(r))},error:function(t){o("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))}})},c=function(t,r,n,o,i){e.util.setDefault(r,"location","S3");var a=function(t){"not_found"===t?o(new e.errors.FPError(121)):"bad_params"===t?o(new e.errors.FPError(122)):"not_authorized"===t?o(new e.errors.FPError(403)):(e.util.console.error(t),o(new e.errors.FPError(123)))},s=function(t){n(e.util.standardizeFPFile(t))};r.filename||(r.filename=t.name||t.fileName),u(t,e.urls.constructStoreUrl(r),s,a,i)},u=function(t,r,n,o,i){t.files&&(t=t.files[0]);var a=!!window.FormData&&!!window.XMLHttpRequest;if(a){var s=new window.FormData;s.append("fileUpload",t),e.ajax.post(r,{json:!0,processData:!1,data:s,success:n,error:o,progress:i})}else e.iframeAjax.post(r,{data:t,json:!0,success:n,error:o})},d=function(t,r,n,o,i){e.util.setDefault(r,"location","S3"),e.util.setDefault(r,"mimetype","text/plain"),e.ajax.post(e.urls.constructStoreUrl(r),{headers:{"Content-Type":r.mimetype},data:t,processData:!1,json:!0,success:function(t){n(e.util.standardizeFPFile(t))},error:function(t){o("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},progress:i})},f=function(t,r,n,o,i){e.util.setDefault(r,"location","S3"),e.ajax.post(e.urls.constructStoreUrl(r),{data:{url:t},json:!0,success:function(t){n(e.util.standardizeFPFile(t))},error:function(t){o("not_found"===t?new e.errors.FPError(151):"bad_params"===t?new e.errors.FPError(152):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(153))},progress:i})},p=function(t,r,n,o){var i=["uploaded","modified","created"];r.cache!==!0&&(r._cacheBust=e.util.getId()),e.ajax.get(t+"/metadata",{json:!0,data:r,success:function(e){for(var t=0;t<i.length;t++)e[i[t]]&&(e[i[t]]=new Date(e[i[t]]));n(e)},error:function(t){o("not_found"===t?new e.errors.FPError(161):"bad_params"===t?new e.errors.FPError(400):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(162))}})},m=function(t,r,n,o){r.key=e.apikey,e.ajax.post(t+"/remove",{data:r,success:function(){n()},error:function(t){o("not_found"===t?new e.errors.FPError(171):"bad_params"===t?new e.errors.FPError(400):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(172))}})};return{readFromUrl:r,readFromFile:n,readFromFPUrl:t,writeDataToFPUrl:o,writeFileToFPUrl:a,writeFileInputToFPUrl:i,writeUrlToFPUrl:s,storeFileInput:l,storeFile:c,storeUrl:f,storeData:d,stat:p,remove:m}}),filepicker.extend("iframeAjax",function(){var e=this,t="ajax_iframe",r=[],n=!1,o=function(e,t){t.method="GET",s(e,t)},i=function(t,r){r.method="POST",t+=(t.indexOf("?")>=0?"&":"?")+"_cacheBust="+e.util.getId(),s(t,r)},a=function(){if(r.length>0){var e=r.shift();s(e.url,e.options)}},s=function(o,i){if(n)return void r.push({url:o,options:i});o+=(o.indexOf("?")>=0?"&":"?")+"plugin="+e.urls.getPlugin()+"&_cacheBust="+e.util.getId(),o+="&Content-Type=text%2Fhtml",e.comm.openChannel();var a;try{a=document.createElement('<iframe name="'+t+'">')}catch(s){a=document.createElement("iframe")}a.id=a.name=t,a.style.display="none";var u=function(){n=!1};a.attachEvent?(a.attachEvent("onload",u),a.attachEvent("onerror",u)):a.onerror=a.onload=u,a.id=t,a.name=t,a.style.display="none",a.onerror=a.onload=function(){n=!1},document.body.appendChild(a),e.handlers.attach("upload",l(i));var d=document.createElement("form");d.method=i.method||"GET",d.action=o,d.target=t;var f=i.data;(e.util.isFileInputElement(f)||e.util.isFile(f))&&(d.encoding=d.enctype="multipart/form-data"),document.body.appendChild(d);var p;if(e.util.isFile(f)){var m=c(f);if(!m)throw e.FilepickerException("Couldn't find corresponding file input.");f={fileUpload:m}}else e.util.isFileInputElement(f)?(p=f,f={},f.fileUpload=p):f&&e.util.isElement(f)&&"INPUT"===f.tagName?(p=f,f={},f[p.name]=p):i.processData!==!1&&(f={data:f});f.format="iframe";var h={};for(var g in f){var v=f[g];if(e.util.isElement(v)&&"INPUT"===v.tagName)h[g]={par:v.parentNode,sib:v.nextSibling,name:v.name,input:v,focused:v===document.activeElement},v.name=g,d.appendChild(v);else{var w=document.createElement("input");w.name=g,w.value=v,d.appendChild(w)}}n=!0,window.setTimeout(function(){d.submit();for(var e in h){var t=h[e];t.par.insertBefore(t.input,t.sib),t.input.name=t.name,t.focused&&t.input.focus()}d.parentNode.removeChild(d)},1)},l=function(t){var r=t.success||function(){},o=t.error||function(){},i=function(t){if("Upload"===t.type){n=!1;var i=t.payload;i.error?o(i.error):r(i),e.handlers.detach("upload"),a()}};return i},c=function(e){for(var t=document.getElementsByTagName("input"),r=0;r<t.length;r++){var n=t[0];if("file"===n.type&&n.files&&n.files.length)for(var o=0;o<n.files.length;o++)if(n.files[o]===e)return n}return null};return{get:o,post:i,request:s}}),filepicker.extend("base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(t,r){r=r||void 0===r;var o,i,a,s,l,c,u,d="",f=0;for(r&&(t=n(t));f<t.length;)o=t.charCodeAt(f),i=t.charCodeAt(f+1),a=t.charCodeAt(f+2),f+=3,s=o>>2,l=(3&o)<<4|i>>4,c=(15&i)<<2|a>>6,u=63&a,isNaN(i)?c=u=64:isNaN(a)&&(u=64),d=d+e.charAt(s)+e.charAt(l)+e.charAt(c)+e.charAt(u);return d},r=function(t,r){r=r||void 0===r;var n,i,a,s,l,c,u,d="",f=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<t.length;)s=e.indexOf(t.charAt(f)),l=e.indexOf(t.charAt(f+1)),c=e.indexOf(t.charAt(f+2)),u=e.indexOf(t.charAt(f+3)),f+=4,n=s<<2|l>>4,i=(15&l)<<4|c>>2,a=(3&c)<<6|u,d+=String.fromCharCode(n),64!=c&&(d+=String.fromCharCode(i)),64!=u&&(d+=String.fromCharCode(a));return r&&(d=o(d)),d},n=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},o=function(e){for(var t="",r=0,n=c2=0;r<e.length;)n=e.charCodeAt(r),128>n?(t+=String.fromCharCode(n),r++):n>191&&224>n?(c2=e.charCodeAt(r+1),t+=String.fromCharCode((31&n)<<6|63&c2),r+=2):(c2=e.charCodeAt(r+1),c3=e.charCodeAt(r+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),r+=3);return t};return{encode:t,decode:r}},!0),filepicker.extend("browser",function(){var e=function(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))},t=function(){return!!navigator.userAgent.match(/Android/i)},r=function(){return!!navigator.userAgent.match(/MSIE 7\.0/i)},n=function(){return navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0},o=function(){return!(!navigator.userAgent.match(/(iPod|iPhone|iPad)/)||!navigator.userAgent.match(/AppleWebKit/)||navigator.userAgent.match(/CriOS/))},i=function(){var e=window.navigator.userLanguage||window.navigator.language;return void 0===e&&(e="en"),e=e.replace("-","_").toLowerCase()},a=e()||t();return{isIOS:e,isAndroid:t,isIE7:r,isSafari:n,isMobileSafari:o,getLanguage:i,isMobile:a}}),filepicker.extend("json",function(){var fp=this,special={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},escape=function(e){return special[e]||"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)},validate=function(e){return e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e)},encode=function(e){if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(e);e&&e.toJSON&&(e=e.toJSON());var t=[];switch(fp.util.typeOf(e)){case"string":return'"'+e.replace(/[\x00-\x1f\\"]/g,escape)+'"';case"array":for(var r=0;r<e.length;r++)t.push(encode(e[r]));return"["+t+"]";case"object":case"hash":var n,o;for(o in e)n=encode(e[o]),n&&t.push(encode(o)+":"+n),n=null;return"{"+t+"}";case"number":case"boolean":return""+e;case"null":return"null";default:return"null"}return null},decode=function(string,secure){if(!string||"string"!==fp.util.typeOf(string))return null;if(window.JSON&&window.JSON.parse)return window.JSON.parse(string);if(secure&&!validate(string))throw new Error("JSON could not decode the input; security is enabled and the value is not secure.");return eval("("+string+")")};return{validate:validate,encode:encode,stringify:encode,decode:decode,parse:decode}}),filepicker.extend("util",function(){var e=function(e){return e.replace(/^\s+|\s+$/g,"")},t=/^(http|https)\:.*\/\//i,r=function(e){return!!e.match(t)},n=function(e){e&&"/"!==e.charAt(0)||(e=window.location.protocol+"//"+window.location.host+e);var t=document.createElement("a");t.href=e;var r=-1===t.hostname.indexOf(":")?t.hostname:t.host,n={source:e,protocol:t.protocol.replace(":",""),host:r,port:t.port,query:t.search,params:function(){for(var e,r={},n=t.search.replace(/^\?/,"").split("&"),o=n.length,i=0;o>i;i++)n[i]&&(e=n[i].split("="),r[e[0]]=e[1]);return r}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[void 0,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[void 0,""])[1],segments:t.pathname.replace(/^\//,"").split("/")};return n.origin=n.protocol+"://"+n.host+(n.port?":"+n.port:""),n},o=function(e,t){return-1!==e.indexOf(t,e.length-t.length)};return{trim:e,parseUrl:n,isUrl:r,endsWith:o}}),filepicker.extend("util",function(){var e=function(e){return e&&"[object Array]"===Object.prototype.toString.call(e)},t=function(e){return e&&"[object File]"===Object.prototype.toString.call(e)},r=function(e){return"object"==typeof window.HTMLElement?e instanceof window.HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},n=function(e){return r(e)&&"INPUT"===e.tagName&&"file"===e.type},o=function(r){return null===r?"null":e(r)?"array":t(r)?"file":typeof r},i=function(){var e=new Date;return e.getTime().toString()},a=function(e,t,r){void 0===e[t]&&(e[t]=r)},s=function(e){if(window.jQuery)window.jQuery(function(){e()});else{var t="load";if(window.addEventListener)window.addEventListener(t,e,!1);else if(window.attachEvent)window.attachEvent("on"+t,e);else if(window.onload){var r=window.onload;window.onload=function(){r(),e()}}else window.onload=e}},l=function(e){return"string"==typeof e&&e.match("www.filepicker.io/api/file/")},c=function(e){return"string"==typeof e&&e.match("/api/file/")},u=function(e){return function(){if(window.console&&"function"==typeof window.console[e])try{window.console[e].apply(window.console,arguments)}catch(t){window.alert(Array.prototype.join.call(arguments,","))}}},d={};d.log=u("log"),d.error=u("error");var f=function(e){var t={};for(var r in e)t[r]=e[r];return t},p=function(e){var t={};return t.url=e.url,t.filename=e.filename||e.name,t.mimetype=e.mimetype||e.type,t.size=e.size,t.key=e.key||e.s3_key,t.isWriteable=!(!e.isWriteable&&!e.writeable),t},m=function(){try{var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}catch(t){return!1}};return{isArray:e,isFile:t,isElement:r,isFileInputElement:n,getId:i,setDefault:a,typeOf:o,addOnLoad:s,isFPUrl:l,isFPUrlCdn:c,console:d,clone:f,standardizeFPFile:p,isCanvasSupported:m}}),filepicker.extend("dragdrop",function(){var e=this,t=function(){return(!!window.FileReader||navigator.userAgent.indexOf("Safari")>=0)&&"draggable"in document.createElement("span")},r=function(r,n){var o="No DOM element found to create drop pane";if(!r)throw new e.FilepickerException(o);if(r.jquery){if(0===r.length)throw new e.FilepickerException(o);r=r[0]}if(!t())return e.util.console.error("Your browser doesn't support drag-drop functionality"),!1;n=n||{};var i=n.dragEnter||function(){},a=n.dragLeave||function(){},s=n.onStart||function(){},l=n.onSuccess||function(){},c=n.onError||function(){},u=n.onProgress||function(){},d=n.mimetypes;d||(d=n.mimetype?[n.mimetype]:["*/*"]),"string"===e.util.typeOf(d)&&(d=d.split(","));var f=n.extensions;f||n.extension&&(f=[n.extension]),"string"===e.util.typeOf(f)&&(f=f.replace(/ /g,"").split(","));var p={location:n.location,path:n.path,container:n.container,access:n.access,policy:n.policy,signature:n.signature},m=function(){return r&&"disabled"!==(r.getAttribute("disabled")||"enabled")};r.addEventListener("dragenter",function(e){return m()&&i(),e.stopPropagation(),e.preventDefault(),!1},!1),r.addEventListener("dragleave",function(e){return m()&&a(),e.stopPropagation(),e.preventDefault(),!1},!1),r.addEventListener("dragover",function(e){return e.dataTransfer.dropEffect="copy",e.preventDefault(),!1},!1),r.addEventListener("drop",function(t){if(t.stopPropagation(),t.preventDefault(),!m())return!1;var n,o,i;if(t.dataTransfer.items)for(o=t.dataTransfer.items,n=0;n<o.length;n++)if(i=o[n]&&o[n].webkitGetAsEntry?o[n].webkitGetAsEntry():void 0,i&&i.isDirectory)return c("WrongType","Uploading a folder is not allowed"),!1;var a=t.dataTransfer.files,l=a.length;if(F(a))for(s(a),r.setAttribute("disabled","disabled"),n=0;n<a.length;n++)e.store(a[n],p,w(n,l),y,x(n,l));return!1});var h=function(){r.setAttribute("disabled","enabled"),window.$&&window.$(r).prop("disabled",!1)},g={},v=[],w=function(e,t){return function(r){n.multiple?(v.push(r),v.length===t?(l(v),v=[],g={}):(g[e]=100,E(t))):l([r]),h()}},y=function(e){c("UploadError",e.toString()),h()},x=function(e,t){return function(r){g[e]=r,E(t)}},E=function(e){var t=0;for(var r in g)t+=g[r];var n=t/e;u(n)},F=function(t){if(t.length>0){if(t.length>1&&!n.multiple)return c("TooManyFiles","Only one file at a time"),!1;if(n.maxFiles>0&&t.length>n.maxFiles)return c("TooManyFiles","Only "+n.maxFiles+" files at a time"),!1;for(var r,o,i,a=0;a<t.length;a++){r=!1,o=t[a],i=o.name||o.fileName||"Unknown file";for(var s=0;s<d.length;s++){var l=e.mimetypes.getMimetype(o);r=r||e.mimetypes.matchesMimetype(l,d[s])}if(!r)return c("WrongType",i+" isn't the right type of file"),!1;if(f){for(r=!1,s=0;s<f.length;s++)r=r||e.util.endsWith(i,f[s]);if(!r)return c("WrongType",i+" isn't the right type of file"),!1}if(o.size&&n.maxSize&&o.size>n.maxSize)return c("WrongSize",i+" is too large ("+o.size+" Bytes)"),!1}return!0}return c("NoFilesFound","No files uploaded"),!1};return!0};return{enabled:t,makeDropPane:r}}),filepicker.extend("widgets",function(){var e=this,t=function(e,t,r,n){var o=n.getAttribute(r);o&&(t[e]=o)},r=function(e,t){var r;document.createEvent?(r=document.createEvent("Event"),r.initEvent("change",!0,!1),r.fpfile=t?t[0]:void 0,r.fpfiles=t,e.dispatchEvent(r)):document.createEventObject?(r=document.createEventObject("Event"),r.eventPhase=2,r.currentTarget=r.srcElement=r.target=e,r.fpfile=t?t[0]:void 0,r.fpfiles=t,e.fireEvent("onchange",r)):e.onchange&&e.onchange(t)},n=function(e,t){t[e]&&(t[e]=t[e].split(","))},o=function(e,r,n){for(var o in n)t(n[o],e,o,r)},i=function(r,i){i=i||"pick";var a={},s={"data-fp-container":"container","data-fp-mimetype":"mimetype","data-fp-extension":"extension","data-fp-openTo":"openTo","data-fp-debug":"debug","data-fp-signature":"signature","data-fp-policy":"policy","data-fp-language":"language","data-fp-background-upload":"backgroundUpload","data-fp-hide":"hide","data-fp-custom-css":"customCss","data-fp-crop-force":"cropForce","data-fp-crop-ratio":"cropRatio","data-fp-crop-dim":"cropDim","data-fp-crop-max":"cropMax","data-fp-crop-min":"cropMin"},l={"data-fp-mimetypes":"mimetypes","data-fp-extensions":"extensions","data-fp-maxSize":"maxSize","data-fp-maxFiles":"maxFiles","data-fp-store-location":"storeLocation","data-fp-store-path":"storePath","data-fp-store-container":"storeContainer","data-fp-store-access":"storeAccess","data-fp-image-quality":"imageQuality","data-fp-image-dim":"imageDim","data-fp-image-max":"imageMax","data-fp-image-min":"imageMin"};o(a,r,s),"export"===i?t("suggestedFilename",a,"data-fp-suggestedFilename",r):"pick"===i&&o(a,r,l);var c=r.getAttribute("data-fp-services");if(c){c=c.split(",");for(var u=0;u<c.length;u++)c[u]=e.services[c[u].replace(" ","")];a.services=c}var d=r.getAttribute("data-fp-service");d&&(a.service=e.services[d.replace(" ","")]);var f=["extensions","mimetypes","imageDim","imageMin","imageMax","cropDim","cropMax","cropMin"];for(var p in f)n(f[p],a);var m=r.getAttribute("data-fp-apikey");return m&&e.setKey(m),a.folders="true"===r.getAttribute("data-fp-folders"),a},a=function(e){return"true"===e.getAttribute("data-fp-multiple")},s=function(t){var n=document.createElement("button");n.setAttribute("type","button"),n.innerHTML=t.getAttribute("data-fp-button-text")||"Pick File",n.className=t.getAttribute("data-fp-button-class")||t.className,t.style.display="none";var o=i(t);n.onclick=a(t)?function(){return n.blur(),e.pickMultiple(o,function(e){for(var n=[],o=0;o<e.length;o++)n.push(e[o].url);t.value=n.join(),r(t,e)}),!1}:function(){return n.blur(),e.pick(o,function(e){t.value=e.url,r(t,[e])}),!1},t.parentNode.insertBefore(n,t.nextSibling)},l=function(t){var n=t.getAttribute("data-fp-url");if(!n)return!0;var o=document.createElement("button");o.setAttribute("type","button"),o.innerHTML=t.getAttribute("data-fp-button-text")||"Convert File",o.className=t.getAttribute("data-fp-button-class")||t.className,t.style.display="none";var a=i(t,"convert");o.onclick=function(){return o.blur(),e.processImage(n,a,function(e){t.value=e.url,r(t,[e])}),!1},t.parentNode.insertBefore(o,t.nextSibling)},c=function(t){var n=document.createElement("div");n.className=t.getAttribute("data-fp-class")||t.className,n.style.padding="1px",t.style.display="none",t.parentNode.insertBefore(n,t.nextSibling);var o=document.createElement("button");o.setAttribute("type","button"),o.innerHTML=t.getAttribute("data-fp-button-text")||"Pick File",o.className=t.getAttribute("data-fp-button-class")||"",n.appendChild(o);var s=document.createElement("div");d(s),s.innerHTML=t.getAttribute("data-fp-drag-text")||"Or drop files here",s.className=t.getAttribute("data-fp-drag-class")||"",n.appendChild(s);var l=i(t),c=a(t);e.dragdrop.enabled()?f(s,c,l,t):s.innerHTML="&nbsp;",s.onclick=o.onclick=c?function(){return o.blur(),e.pickMultiple(l,function(e){for(var n=[],o=[],i=0;i<e.length;i++)n.push(e[i].url),o.push(e[i].filename);t.value=n.join(),u(t,s,o.join(", ")),r(t,e)}),!1}:function(){return o.blur(),e.pick(l,function(e){t.value=e.url,u(t,s,e.filename),r(t,[e])}),!1}},u=function(t,n,o){n.innerHTML=o,n.style.padding="2px 4px",n.style.cursor="default",n.style.width="";var i=document.createElement("span");i.innerHTML="X",i.style.borderRadius="8px",i.style.fontSize="14px",i.style.cssFloat="right",i.style.padding="0 3px",i.style.color="#600",i.style.cursor="pointer";var a=function(o){return o||(o=window.event),o.cancelBubble=!0,o.stopPropagation&&o.stopPropagation(),d(n),n.innerHTML=e.dragdrop.enabled?t.getAttribute("data-fp-drag-text")||"Or drop files here":"&nbsp;",t.value="",r(t),!1};i.addEventListener?i.addEventListener("click",a,!1):i.attachEvent&&i.attachEvent("onclick",a),n.appendChild(i)},d=function(e){e.style.border="1px dashed #AAA",e.style.display="inline-block",e.style.margin="0 0 0 4px",e.style.borderRadius="3px",e.style.backgroundColor="#F3F3F3",e.style.color="#333",e.style.fontSize="14px",e.style.lineHeight="22px",e.style.padding="2px 4px",e.style.verticalAlign="middle",e.style.cursor="pointer",e.style.overflow="hidden"},f=function(t,n,o,i){var a,s=t.innerHTML;e.dragdrop.makeDropPane(t,{multiple:n,maxSize:o.maxSize,mimetypes:o.mimetypes,mimetype:o.mimetype,extensions:o.extensions,extension:o.extension,location:o.storeLocation,path:o.storePath,container:o.storeContainer,access:o.storeAccess,policy:o.policy,signature:o.signature,dragEnter:function(){t.innerHTML="Drop to upload",t.style.backgroundColor="#E0E0E0",t.style.border="1px solid #000"},dragLeave:function(){t.innerHTML=s,t.style.backgroundColor="#F3F3F3",t.style.border="1px dashed #AAA"},onError:function(e,r){"TooManyFiles"===e?t.innerHTML=r:"WrongType"===e?t.innerHTML=r:"NoFilesFound"===e?t.innerHTML=r:"UploadError"===e&&(t.innerHTML="Oops! Had trouble uploading.")},onStart:function(){a=p(t)},onProgress:function(e){a&&(a.style.width=e+"%")},onSuccess:function(e){for(var n=[],o=[],a=0;a<e.length;a++)n.push(e[a].url),o.push(e[a].filename);i.value=n.join(),u(i,t,o.join(", ")),r(i,e)}})},p=function(e){var t=document.createElement("div"),r=e.offsetHeight-2;return t.style.height=r+"px",t.style.backgroundColor="#0E90D2",t.style.width="2%",t.style.borderRadius="3px",e.style.width=e.offsetWidth+"px",e.style.padding="0",e.style.border="1px solid #AAA",e.style.backgroundColor="#F3F3F3",e.style.boxShadow="inset 0 1px 2px rgba(0, 0, 0, 0.1)",e.innerHTML="",e.appendChild(t),t},m=function(t){t.onclick=function(){var r=t.getAttribute("data-fp-url");if(!r)return!0;var n=i(t,"export");return e.exportFile(r,n),!1}},h=function(){if(document.querySelectorAll){var e,t=document.querySelectorAll('input[type="filepicker"]');for(e=0;e<t.length;e++)s(t[e]);var r=document.querySelectorAll('input[type="filepicker-dragdrop"]');for(e=0;e<r.length;e++)c(r[e]);var n=document.querySelectorAll('input[type="filepicker-convert"]');for(e=0;e<n.length;e++)l(n[e]);var o=[],i=document.querySelectorAll("button[data-fp-url]");for(e=0;e<i.length;e++)o.push(i[e]);for(i=document.querySelectorAll("a[data-fp-url]"),e=0;e<i.length;e++)o.push(i[e]);for(i=document.querySelectorAll('input[type="button"][data-fp-url]'),e=0;e<i.length;e++)o.push(i[e]);for(e=0;e<o.length;e++)m(o[e]);var a=document.querySelectorAll('[type="filepicker-preview"][data-fp-url]');for(e=0;e<a.length;e++)v(a[e])}},g=function(e){e.jquery&&(e=e[0]);var t=e.getAttribute("type");"filepicker"===t?s(e):"filepicker-dragdrop"===t?c(e):m(e)},v=function(t){var r=t.getAttribute("data-fp-url");if(!r||!e.util.isFPUrl(r))return!0;r=r.replace("api/file/","api/preview/");var n=document.createElement("iframe");n.src=r,n.width="100%",n.height="100%",t.appendChild(n)};return{constructPickWidget:s,constructDragWidget:c,constructExportWidget:m,buildWidgets:h,constructWidget:g}}),filepicker.extend("conversions",function(){var e=this,t={align:"string",blurAmount:"number",crop:"string or array",compress:"boolean",filter:"string",fit:"string",format:"string",height:"number",policy:"string",quality:"number",page:"number",rotate:"string or number",sharpenAmount:"number",signature:"string",storeAccess:"string",storeContainer:"string",storeLocation:"string",storePath:"string",text:"string",text_align:"string",text_color:"string",text_font:"string",text_padding:"number",text_size:"number",watermark:"string",watermark_position:"string",watermark_size:"number",width:"number"},r=function(r){var n;for(var o in r){n=!1;for(var i in t)if(o===i&&(n=!0,-1===t[i].indexOf(e.util.typeOf(r[o]))))throw new e.FilepickerException("Conversion parameter "+o+" is not the right type: "+r[o]+". Should be a "+t[i]);if(!n)throw new e.FilepickerException("Conversion parameter "+o+" is not a valid parameter.")}},n=function(t,n,o,i,a){r(n),n.crop&&e.util.isArray(n.crop)&&(n.crop=n.crop.join(",")),e.ajax.post(t+"/convert",{data:n,json:!0,success:function(t){o(e.util.standardizeFPFile(t))},error:function(t){i("not_found"===t?new e.errors.FPError(141):"bad_params"===t?new e.errors.FPError(142):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(143))},progress:a})};return{convert:n}}),filepicker.extend(function(){var e=this;e.API_VERSION="v2";var t=function(t){e.apikey=t},r=function(e){return this.text=e,this.toString=function(){return"FilepickerException: "+this.text},this};r.isClass=!0;var n=function(){if(!e.apikey)throw new e.FilepickerException("API Key not found")},o=function(t,r,o,i){n(),"function"==typeof t&&(o=r,r=t,t={}),t=t||{},r=r||function(){},o=o||e.errors.handleError,e.picker.createPicker(t,r,o,!1,!1,i)},i=function(t,r,o,i){n(),"function"==typeof t&&(i=o,o=r,r=t,t={}),t=t||{},r=r||function(){},o=o||e.errors.handleError,e.picker.createPicker(t,r,o,!0,!1,i)},a=function(t,r,o,i,a){if(n(),!t||!r||"function"==typeof t||"function"==typeof t)throw new e.FilepickerException("Not all required parameters given, missing picker or store options");i=i||e.errors.handleError;var s=!!t.multiple,l=t?e.util.clone(t):{};if(l.storeLocation=r.location||"S3",l.storePath=r.path,l.storeContainer=r.storeContainer||r.container,l.storeAccess=r.access||"private",s&&l.storePath&&"/"!==l.storePath.charAt(l.storePath.length-1))throw new e.FilepickerException(0/0);var c=o;s||(c=function(e){o([e])}),e.picker.createPicker(l,c,i,s,!1,a)},s=function(t,r,o,i){n(),"function"==typeof t&&(o=r,r=t,t={}),t=t||{},r=r||function(){},o=o||e.errors.handleError,e.picker.createPicker(t,r,o,!1,!0,i)},l=function(t,r,o,i,a){if(n(),!t)throw new e.FilepickerException("No input given - nothing to read!");if("function"==typeof r&&(a=i,i=o,o=r,r={}),r=r||{},o=o||function(){},i=i||e.errors.handleError,a=a||function(){},"string"==typeof t)e.util.isFPUrl(t)?e.files.readFromFPUrl(t,r,o,i,a):e.files.readFromUrl(t,r,o,i,a);else if(e.util.isFileInputElement(t))t.files?0===t.files.length?i(new e.errors.FPError(115)):e.files.readFromFile(t.files[0],r,o,i,a):c(t,r,o,i,a);else if(e.util.isFile(t))e.files.readFromFile(t,r,o,i,a);else{if(!t.url)throw new e.FilepickerException("Cannot read given input: "+t+". Not a url, file input, DOM File, or FPFile object.");e.files.readFromFPUrl(t.url,r,o,i,a)}},c=function(t,r,n,o,i){i(10),e.store(t,function(t){i(50),e.read(t,r,n,o,function(e){i(50+e/2)})},o)},u=function(t,r,o,i,a,s){if(n(),!t)throw new e.FilepickerException("No fpfile given - nothing to write to!");if(void 0===r||null===r)throw new e.FilepickerException("No input given - nothing to write!");"function"==typeof o&&(s=a,a=i,i=o,o={}),o=o||{},i=i||function(){},a=a||e.errors.handleError,s=s||function(){};var l;if(e.util.isFPUrl(t))l=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to write to: "+t+". Not a filepicker url or FPFile object.");l=t.url}if("string"==typeof r)e.files.writeDataToFPUrl(l,r,o,i,a,s);else if(e.util.isFileInputElement(r))r.files?0===r.files.length?a(new e.errors.FPError(115)):e.files.writeFileToFPUrl(l,r.files[0],o,i,a,s):e.files.writeFileInputToFPUrl(l,r,o,i,a,s);else if(e.util.isFile(r))e.files.writeFileToFPUrl(l,r,o,i,a,s);else{if(!r.url)throw new e.FilepickerException("Cannot read from given input: "+r+". Not a string, file input, DOM File, or FPFile object.");e.files.writeUrlToFPUrl(l,r.url,o,i,a,s)}},d=function(t,r,o,i,a,s){if(n(),!t)throw new e.FilepickerException("No fpfile given - nothing to write to!");if(void 0===r||null===r)throw new e.FilepickerException("No input given - nothing to write!");"function"==typeof o&&(s=a,a=i,i=o,o={}),o=o||{},i=i||function(){},a=a||e.errors.handleError,s=s||function(){};var l;if(e.util.isFPUrl(t))l=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to write to: "+t+". Not a filepicker url or FPFile object.");l=t.url}e.files.writeUrlToFPUrl(l,r,o,i,a,s)},f=function(t,r,o,i){n(),"function"==typeof r&&(i=o,o=r,r={}),r=r?e.util.clone(r):{},o=o||function(){},i=i||e.errors.handleError;var a;if("string"==typeof t&&e.util.isUrl(t))a=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to export: "+t+". Not a valid url or FPFile object. You may want to use filepicker.store() to get an FPFile to export");a=t.url,r.mimetype||r.extension||(r.mimetype=t.mimetype),r.suggestedFilename||(r.suggestedFilename=t.filename)}r.suggestedFilename&&(r.suggestedFilename=encodeURI(r.suggestedFilename)),e.exporter.createExporter(a,r,o,i)},p=function(t,r,o,i,a){var s;if(n(),"function"==typeof r&&(i=o,o=r,r={}),r=r||{},o=o||function(){},i=i||e.errors.handleError,"string"==typeof t&&e.util.isFPUrlCdn(t))s=t;else{if(!t.url||!e.util.isFPUrl(t.url))throw new e.FilepickerException("Invalid file to convert: "+t+". Not a valid url or FPFile object or not filepicker url. You can convert only filepicker url images.");s=t.url,r.filename||(r.filename=t.filename)}r.convertUrl=s,r.multiple=!1,r.services=["CONVERT","COMPUTER"],r.backgroundUpload=!0,r.hide=!1,e.picker.createPicker(r,o,i,!1,!1,a,!0)},m=function(t,r,o,i,a){if(n(),"function"==typeof r&&(a=i,i=o,o=r,r={}),r=r?e.util.clone(r):{},o=o||function(){},i=i||e.errors.handleError,a=a||function(){},"string"==typeof t)e.files.storeData(t,r,o,i,a);else if(e.util.isFileInputElement(t))t.files?0===t.files.length?i(new e.errors.FPError(115)):e.files.storeFile(t.files[0],r,o,i,a):e.files.storeFileInput(t,r,o,i,a);else if(e.util.isFile(t))e.files.storeFile(t,r,o,i,a);else{if(!t.url)throw new e.FilepickerException("Cannot store given input: "+t+". Not a string, file input, DOM File, or FPFile object.");r.filename||(r.filename=t.filename),e.files.storeUrl(t.url,r,o,i,a)}},h=function(t,r,o,i,a){n(),"function"==typeof r&&(a=i,i=o,o=r,r={}),r=r||{},o=o||function(){},i=i||e.errors.handleError,a=a||function(){},e.files.storeUrl(t,r,o,i,a)},g=function(t,r,o,i){n(),"function"==typeof r&&(i=o,o=r,r={}),r=r||{},o=o||function(){},i=i||e.errors.handleError;var a;if(e.util.isFPUrl(t))a=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to get metadata for: "+t+". Not a filepicker url or FPFile object.");a=t.url}e.files.stat(a,r,o,i)},v=function(t,r,o,i){n(),"function"==typeof r&&(i=o,o=r,r={}),r=r||{},o=o||function(){},i=i||e.errors.handleError;var a;if(e.util.isFPUrl(t))a=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to remove: "+t+". Not a filepicker url or FPFile object.");a=t.url}e.files.remove(a,r,o,i)},w=function(t,r,o,i,a,s){if(n(),!t)throw new e.FilepickerException("No fpfile given - nothing to convert!");"function"==typeof o&&(s=a,a=i,i=o,o={});var l=r?e.util.clone(r):{};o=o||{},i=i||function(){},a=a||e.errors.handleError,s=s||function(){},o.location&&(l.storeLocation=o.location),o.path&&(l.storePath=o.path),o.container&&(l.storeContainer=o.container),l.storeAccess=o.access||"private";var c;if(e.util.isFPUrl(t))c=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to convert: "+t+". Not a filepicker url or FPFile object.");if(c=t.url,!e.mimetypes.matchesMimetype(t.mimetype,"image/*")&&!e.mimetypes.matchesMimetype(t.mimetype,"application/pdf"))return void a(new e.errors.FPError(142))}e.conversions.convert(c,l,i,a,s)},y=function(t){return e.widgets.constructWidget(t)},x=function(t,r){return e.dragdrop.makeDropPane(t,r)};return{setKey:t,pick:o,pickFolder:s,pickMultiple:i,pickAndStore:a,read:l,write:u,writeUrl:d,"export":f,exportFile:f,processImage:p,store:m,storeUrl:h,stat:g,metadata:g,remove:v,convert:w,constructWidget:y,makeDropPane:x,FilepickerException:r}},!0),filepicker.extend("mimetypes",function(){var e=this,t={".stl":"application/sla",".hbs":"text/html",".pdf":"application/pdf",".jpg":"image/jpeg",".jpeg":"image/jpeg",".jpe":"image/jpeg",".imp":"application/x-impressionist"},r=["application/octet-stream","application/download","application/force-download","octet/stream","application/unknown","application/x-download","application/x-msdownload","application/x-secure-download"],n=function(e){if(e.type){var n=e.type;n=n.toLowerCase();for(var o=!1,i=0;i<r.length;i++)o=o||n===r[i];if(!o)return e.type}var a=e.name||e.fileName,s=a.match(/\.\w*$/);return s?t[s[0].toLowerCase()]||"":e.type?e.type:""},o=function(t,n){if(!t)return"*/*"===n;t=e.util.trim(t).toLowerCase(),n=e.util.trim(n).toLowerCase();for(var o=0;o<r.length;o++)if(t===r[o])return!0;var i=t.split("/"),a=n.split("/");return"*"===a[0]?!0:a[0]!==i[0]?!1:"*"===a[1]?!0:a[1]===i[1]};return{getMimetype:n,matchesMimetype:o}}),filepicker.extend("services",function(){return{COMPUTER:1,DROPBOX:2,FACEBOOK:3,GITHUB:4,GMAIL:5,IMAGE_SEARCH:6,URL:7,WEBCAM:8,GOOGLE_DRIVE:9,SEND_EMAIL:10,INSTAGRAM:11,FLICKR:12,VIDEO:13,EVERNOTE:14,PICASA:15,WEBDAV:16,FTP:17,ALFRESCO:18,BOX:19,SKYDRIVE:20,GDRIVE:21,CUSTOMSOURCE:22,CLOUDDRIVE:23,GENERIC:24,CONVERT:25}},!0),filepicker.extend("urls",function(){function e(e,o){return"?key="+n.apikey+"&id="+o+"&referrer="+window.location.hostname+"&iframe="+("window"!==e.container)+"&version="+n.API_VERSION+(e.services?"&s="+e.services.join(","):"")+(void 0!==e.container?"&container="+e.container:"modal")+(e.openTo?"&loc="+e.openTo:"")+"&language="+(e.language||n.browser.getLanguage())+(void 0!==e.mobile?"&mobile="+e.mobile:"")+(void 0!==e.backgroundUpload?"&bu="+e.backgroundUpload:"")+(e.cropRatio?"&cratio="+e.cropRatio:"")+(e.cropDim?"&cdim="+e.cropDim.join(","):"")+(e.cropMax?"&cmax="+e.cropMax.join(","):"")+(e.cropMin?"&cmin="+e.cropMin.join(","):"")+(void 0!==e.cropForce?"&cforce="+e.cropForce:"")+(void 0!==e.hide?"&hide="+e.hide:"")+(e.customCss?"&css="+encodeURIComponent(e.customCss):"")+(e.imageMin?"&imin="+e.imageMin.join(","):"")+(e.imageMax?"&imax="+e.imageMax.join(","):"")+(e.imageDim?"&idim="+e.imageDim.join(","):"")+(e.imageQuality?"&iq="+e.imageQuality:"")+(n.util.isCanvasSupported()?"":"&canvas=false")+t(e)+"&plugin="+r()}function t(e){return(e.signature?"&signature="+e.signature:"")+(e.policy?"&policy="+e.policy:"")}function r(){return filepicker.plugin||"js_lib"}var n=this,o="https://www.filepicker.io";window.filepicker.hostname&&(o=window.filepicker.hostname);var i=o.replace("www","dialog"),a=i+"/dialog/open/",s=i+"/dialog/save/",l=i+"/dialog/process/",c=i+"/dialog/folder/",u=o+"/api/store/",d=function(t,r,n){return a+e(t,r)+(n?"&multi="+!!n:"")+(void 0!==t.mimetypes?"&m="+t.mimetypes.join(","):"")+(void 0!==t.extensions?"&ext="+t.extensions.join(","):"")+(t.maxSize?"&maxSize="+t.maxSize:"")+(t.maxFiles?"&maxFiles="+t.maxFiles:"")+(void 0!==t.folders?"&folders="+t.folders:"")+(t.storeLocation?"&storeLocation="+t.storeLocation:"")+(t.storePath?"&storePath="+t.storePath:"")+(t.storeContainer?"&storeContainer="+t.storeContainer:"")+(t.storeAccess?"&storeAccess="+t.storeAccess:"")},f=function(t,r){return l+e(t,r)+"&curl="+t.convertUrl+(t.convertUrl?"&curl="+t.convertUrl:"")},p=function(t,r){return c+e(t,r)},m=function(t,r,n){return(t.indexOf("&")>=0||t.indexOf("?")>=0)&&(t=encodeURIComponent(t)),s+e(r,n)+"&url="+t+(void 0!==r.mimetype?"&m="+r.mimetype:"")+(void 0!==r.extension?"&ext="+r.extension:"")+(r.suggestedFilename?"&defaultSaveasName="+r.suggestedFilename:"")},h=function(e){return u+e.location+"?key="+n.apikey+(e.base64decode?"&base64decode=true":"")+(e.mimetype?"&mimetype="+e.mimetype:"")+(e.filename?"&filename="+encodeURIComponent(e.filename):"")+(e.path?"&path="+e.path:"")+(e.container?"&container="+e.container:"")+(e.access?"&access="+e.access:"")+t(e)+"&plugin="+r()},g=function(e,n){return e+"?nonce=fp"+(n.base64decode?"&base64decode=true":"")+(n.mimetype?"&mimetype="+n.mimetype:"")+t(n)+"&plugin="+r()},v=function(){var e=n.util.parseUrl(window.location.href);return e.origin+"/404"};return{BASE:o,DIALOG_BASE:i,API_COMM:o+"/dialog/comm_iframe/",COMM:i+"/dialog/comm_iframe/",FP_COMM_FALLBACK:i+"/dialog/comm_hash_iframe/",STORE:u,PICK:a,EXPORT:s,constructPickUrl:d,constructConvertUrl:f,constructPickFolderUrl:p,constructExportUrl:m,constructWriteUrl:g,constructStoreUrl:h,constructHostCommFallback:v,getPlugin:r}}),function(){filepicker.internal(function(){var e=this;e.util.addOnLoad(e.cookies.checkThirdParty),e.util.addOnLoad(e.widgets.buildWidgets)}),delete filepicker.internal,delete filepicker.extend;var e,t=filepicker._queue||[],r=t.length;if(r)for(var n=0;r>n;n++)e=t[n],filepicker[e[0]].apply(filepicker,e[1]);filepicker._queue&&delete filepicker._queue}();
    })();
    return filepicker;
  }]);
})();